<div
  class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-[#556B2F]/10 p-4 rounded-lg border-l-4 border-[#556B2F]"
>
  <div>
    <h1 class="text-2xl font-bold text-[#4b6b1c]">Gesti√≥n de Tareas</h1>
    <p class="text-[#7a7a5c] text-sm">Organiza las tareas de tu equipo</p>
  </div>

  <div class="flex flex-col sm:flex-row sm:flex-wrap gap-2 w-full lg:w-auto">
    <!-- Bot√≥n de descarga -->
    <button
      (click)="descargarTareas()"
      class="rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#556B2F] disabled:opacity-50 disabled:pointer-events-none h-10 py-2 px-4 flex items-center gap-2 bg-[#556B2F] hover:bg-[#556B2F]/90 text-white w-full sm:w-auto justify-center"
      title="Descargar tareas"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 mr-1"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5 5-5M12 15V3"
        />
      </svg>
      Descargar
    </button>

    <!-- Bot√≥n de enviar por email -->
    <button
      (click)="enviarTareasPorEmail()"
      class="rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#556B2F] disabled:opacity-50 disabled:pointer-events-none h-10 py-2 px-4 flex items-center gap-2 bg-[#556B2F] hover:bg-[#556B2F]/90 text-white w-full sm:w-auto justify-center"
      title="Enviar tareas por email"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 mr-1"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M16 12h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v4a2 2 0 002 2h2m4 0v6m0 0l-3-3m3 3l3-3"
        />
      </svg>
      Enviar Email
    </button>

    <!-- Bot√≥n de asignar tarea -->
    <button
      class="rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#556B2F] disabled:opacity-50 disabled:pointer-events-none h-10 py-2 px-4 flex items-center gap-2 bg-[#556B2F] hover:bg-[#556B2F]/90 text-white w-full sm:w-auto justify-center"
      (click)="openModal()"
    >
      + Asignar Tarea
    </button>
  </div>
</div>

<!-- Modal -->
@if (showModal) {
  <app-form-modal
    [isOpen]="showModal"
    [title]="'Asignar Nueva Tarea'"
    [formGroup]="tareasForm"
    [submitLabel]="'Guardar'"
    [isSubmitting]="isSubmitting"
    (close)="closeModal()"
    (submit)="insertarTarea()"
  >
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none text-[#1C1C1C] peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="titulo">Titulo</label>
        <input class="flex h-10 w-full rounded-md border bg-white px-3 py-2 text-sm text-[#1C1C1C] placeholder:text-[#1C1C1C]/50 focus-visible:outline-none focus-visible:ring-2 disabled:cursor-not-allowed disabled:opacity-50 border-[#D4AF37]/30 focus-visible:ring-[#D4AF37]" id="titulo" formControlName="titulo" placeholder="" required name="titulo" />
      </div>
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none text-[#1C1C1C] peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="descripcion">Descripcion</label>
        <input class="flex h-10 w-full rounded-md border bg-white px-3 py-2 text-sm text-[#1C1C1C] placeholder:text-[#1C1C1C]/50 focus-visible:outline-none focus-visible:ring-2 disabled:cursor-not-allowed disabled:opacity-50 border-[#D4AF37]/30 focus-visible:ring-[#D4AF37]" id="descripcion" formControlName="descripcion" placeholder="" required name="descripcion" />
      </div>
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none text-[#1C1C1C] peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="fecha_inicio">Fecha Inicio</label>
        <input class="flex h-10 w-full rounded-md border bg-white px-3 py-2 text-sm text-[#1C1C1C] placeholder:text-[#1C1C1C]/50 focus-visible:outline-none focus-visible:ring-2 disabled:cursor-not-allowed disabled:opacity-50 border-[#D4AF37]/30 focus-visible:ring-[#D4AF37]" id="fecha_inicio" formControlName="fecha_inicio" placeholder="" required type="date" name="fecha_inicio" />
      </div>
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none text-[#1C1C1C] peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="fecha_finalizacion">Fecha Finalizacion</label>
        <input class="flex h-10 w-full rounded-md border bg-white px-3 py-2 text-sm text-[#1C1C1C] placeholder:text-[#1C1C1C]/50 focus-visible:outline-none focus-visible:ring-2 disabled:cursor-not-allowed disabled:opacity-50 border-[#D4AF37]/30 focus-visible:ring-[#D4AF37]" id="fecha_finalizacion" formControlName="fecha_finalizacion" placeholder="" required type="date" name="fecha_finalizacion" />
      </div>
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none text-[#1C1C1C] peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="hora_inicio">Hora de inicio</label>
        <input class="flex h-10 w-full rounded-md border bg-white px-3 py-2 text-sm text-[#1C1C1C] placeholder:text-[#1C1C1C]/50 focus-visible:outline-none focus-visible:ring-2 disabled:cursor-not-allowed disabled:opacity-50 border-[#D4AF37]/30 focus-visible:ring-[#D4AF37]" id="hora_inicio" formControlName="hora_inicio" required type="time" name="hora_inicio" />
      </div>
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none text-[#1C1C1C] peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="hora_finalizacion">Hora Finalizacion</label>
        <input class="flex h-10 w-full rounded-md border bg-white px-3 py-2 text-sm text-[#1C1C1C] placeholder:text-[#1C1C1C]/50 focus-visible:outline-none focus-visible:ring-2 disabled:cursor-not-allowed disabled:opacity-50 border-[#D4AF37]/30 focus-visible:ring-[#D4AF37]" id="hora_finalizacion" formControlName="hora_finalizacion" placeholder="" required type="time" name="hora_finalizacion" />
      </div>
      <div class="space-y-2 md:col-span-2">
        <label class="text-sm font-medium leading-none text-[#1C1C1C] peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="estado">Estado</label>
        <select id="estado" formControlName="estado" name="estado" class="flex h-10 w-full rounded-md border border-[#D4AF37]/30 bg-white px-3 py-2 text-sm text-[#1C1C1C] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#D4AF37]" required>
          <option value="Completada">Completada</option>
          <option value="En Curso">En Curso</option>
          <option value="Pendiente">Pendiente</option>
        </select>
      </div>
    </div>
    <div class="space-y-2">
      <label class="text-sm font-medium leading-none text-[#1C1C1C] peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="empleado_id">Empleado</label>
      <select class="flex h-10 w-full rounded-md border bg-white px-3 py-2 text-sm text-[#1C1C1C] placeholder:text-[#1C1C1C]/50 focus-visible:outline-none focus-visible:ring-2 disabled:cursor-not-allowed disabled:opacity-50 border-[#D4AF37]/30 focus-visible:ring-[#D4AF37]" id="empleado_id" formControlName="empleado_id" required>
        <option value="" disabled>Selecciona un empleado</option>
        @for (empleado of empleados; track empleado.id) {
          <option [value]="empleado.id">{{ empleado.nombre }} {{ empleado.apellidos }}</option>
        }
      </select>
    </div>
  </app-form-modal>
}
<!-- üü§ TAREAS POR EMPLEADO ------------------------------------------------- -->
<!--
  Descripci√≥n: Tabla de tareas agrupadas por empleado.
  Notas:
    ‚Ä¢ Cada empleado tiene su propia tabla.
    ‚Ä¢ El contenedor y la tabla tienen esquinas redondeadas (rounded-xl).
    ‚Ä¢ Responsive con overflow-x-auto.
    ‚Ä¢ Incluye bot√≥n para eliminar tarea.
-->
<div class="mt-8">
  <h2 class="text-xl font-bold text-[#4b6b1c] mb-4">Tareas por Empleado</h2>
  @for (empleado of getTareasPorEmpleado() | keyvalue; track empleado.key) {
  <div class="mb-8 overflow-x-auto w-full border border-[#d9dbc7] rounded-xl shadow bg-white">
    <h3 class="text-lg font-semibold text-[#4b6b1c] p-2">
      {{ empleado.key }} -
      {{ getEmpleadosById(+empleado.key)?.nombre || "Sin nombre" }}
      {{ getEmpleadosById(+empleado.key)?.apellidos || "Sin apellidos" }}
    </h3>
    <table class="min-w-[800px] w-full border-collapse rounded-xl bg-white">
      <thead class="bg-[#e9ebdd]">
        <tr>
          <th class="px-4 py-2 border-b border-[#d9dbc7] text-center text-[#4b6b1c]">T√≠tulo</th>
          <th class="px-4 py-2 border-b border-[#d9dbc7] text-center text-[#4b6b1c]">Descripci√≥n</th>
          <th class="px-4 py-2 border-b border-[#d9dbc7] text-center text-[#4b6b1c]">Fecha Inicio</th>
          <th class="px-4 py-2 border-b border-[#d9dbc7] text-center text-[#4b6b1c]">Fecha Finalizaci√≥n</th>
          <th class="px-4 py-2 border-b border-[#d9dbc7] text-center text-[#4b6b1c]">Hora Inicio</th>
          <th class="px-4 py-2 border-b border-[#d9dbc7] text-center text-[#4b6b1c]">Hora Finalizaci√≥n</th>
          <th class="px-4 py-2 border-b border-[#d9dbc7] text-center text-[#4b6b1c]">Estado</th>
          <th class="w-12 px-4 py-2 border-b border-[#d9dbc7] text-center"></th>
        </tr>
      </thead>
      <tbody>
        @for (tarea of empleado.value; track tarea.id) {
        <tr class="hover:bg-[#f3f3ec]">
          <td class="px-4 py-2 border-b text-center border-[#d9dbc7]">{{ tarea.titulo }}</td>
          <td class="px-4 py-2 border-b text-center border-[#d9dbc7]">{{ tarea.descripcion }}</td>
          <td class="px-4 py-2 border-b text-center border-[#d9dbc7]">{{ tarea.fecha_inicio | date : "dd-MM-yyyy" }}</td>
          <td class="px-4 py-2 border-b text-center border-[#d9dbc7]">{{ tarea.fecha_finalizacion | date : "dd-MM-yyyy" }}</td>
          <td class="px-4 py-2 border-b text-center border-[#d9dbc7]">{{ tarea.hora_inicio }}</td>
          <td class="px-4 py-2 border-b text-center border-[#d9dbc7]">{{ tarea.hora_finalizacion }}</td>
          <td class="px-4 py-2 border-b text-center border-[#d9dbc7]">{{ getEstadoTarea(tarea) }}</td>
          <td class="flex justify-between items-center flex gap-2 pt-2 border-t border-[#D4AF37]/10">
            <button
              (click)="eliminarTarea(tarea.id)"
              class="text-red-600 hover:text-red-800"
              title="Eliminar"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-trash2 h-4 w-4">
                <path d="M3 6h18"></path>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                <line x1="10" x2="10" y1="11" y2="17"></line>
                <line x1="14" x2="14" y1="11" y2="17"></line>
              </svg>
            </button>
            <button
              class="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#556B2F] disabled:opacity-50 disabled:pointer-events-none hover:text-[#556B2F] h-8 px-3 text-xs text-[#556B2F] hover:bg-[#556B2F]/10"
              (click)="openModal(tarea)"
              title="Editar tarea"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-square-pen h-4 w-4">
                <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"></path>
              </svg>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }
</div>
<!-- ----------------------------------------------------------------------- -->
